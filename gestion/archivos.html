
    HTML:
    <!DOCTYPE html>
    <html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Gestión de Archivos PDF</title>
        <link rel="icon" type="image/png" href="../imagenes/descargar.png">
        <link rel="stylesheet" href="diseñog.css">
    </head>
    <body>
        <div class="menu-overlay"></div>
        <div class="loading" id="loading">
            <div class="spinner"></div>
        </div>

    <header>
        <button class="menu-toggle" onclick="toggleMenu()">☰</button>
        <nav class="menu">
            <ul>
                <li><a href="../index.html">Inicio</a></li>
                <li class="submenu">
                    <a href="javascript:void(0);" onclick="toggleSubmenu(event)">Datos Nacionales</a>
                    <ul class="submenu-list">
                        <li><a href="../datos_nacionales/datosindex.html">Datos Nacionales</a></li>
                        <li><a href="../datos_nacionales/opcionesdatos/plantillad.html">Plantilla de Personal</a></li>
                        <li><a href="../datos_nacionales/opcionesdatos/tabulador.html">Tabulador</a></li>
                        <li><a href="../datos_nacionales/opcionesdatos/rubro.html">Gastos de Operación</a></li>
                        <li><a href="../datos_nacionales/opcionesdatos/unidadcd.html">Unidades Caninas</a></li>
                        <li><a href="../construccion.html">Inmuebles</a></li>
                        <li><a href="archivos.html">Gestión de Archivos</a></li>
                    </ul>
                </li>

                <li class="submenu">
                    <a href="javascript:void(0);" onclick="toggleSubmenu(event)">Información de ORs</a>
                    <ul class="submenu-list">
                        <li><a href="../estados/aguascalientes/aguascalientesindex.html">Aguascalientes</a></li>
                        <li><a href="../estados/baja_california/baja_californiaindex.html">Baja California</a></li>
                        <li><a href="../estados/baja_california_s/baja_california_surindex.html">Baja California Sur</a></li>
                        <li><a href="../estados/campeche/campecheindex.html">Campeche</a></li>
                        <li><a href="../estados/chiapas/chiapasindex.html">Chiapas</a></li>
                        <li><a href="../estados/chihuahua/chihuahuaindex.html">Chihuahua</a></li>
                        <li><a href="../estados/cdmx/cdmxindex.html">Ciudad de México</a></li>
                        <li><a href="../estados/coahuila/coahuilaindex.html">Coahuila</a></li>
                        <li><a href="../estados/colima/colimaindex.html">Colima</a></li>
                        <li><a href="../estados/durango/durangoindex.html">Durango</a></li>
                        <li><a href="../estados/guanajuato/guanajuatoindex.html">Guanajuato</a></li>
                        <li><a href="../estados/guerrero/guerreroindex.html">Guerrero</a></li>
                        <li><a href="../estados/hidalgo/hidalgoindex.html">Hidalgo</a></li>
                        <li><a href="../estados/jalisco/jaliscoindex.html">Jalisco</a></li>
                        <li><a href="../estados/edomex/edomexindex.html">Estado de México</a></li>
                        <li><a href="../estados/michoacan/michoacanindex.html">Michoacán</a></li>
                        <li><a href="../estados/morelos/morelosindex.html">Morelos</a></li>
                        <li><a href="../estados/nayarit/nayaritindex.html">Nayarit</a></li>
                        <li><a href="../estados/nuevo_leon/nuevolindex.html">Nuevo León</a></li>
                        <li><a href="../estados/oaxaca/oaxacaindex.html">Oaxaca</a></li>
                        <li><a href="../estados/puebla/pueblaindex.html">Puebla</a></li>
                        <li><a href="../estados/queretaro/queretaroindex.html">Querétaro</a></li>
                        <li><a href="../estados/quintanaroo/quintanarooindex.html">Quintana Roo</a></li>
                        <li><a href="../estados/san_luis/san_luisindex.html">San Luis Potosí</a></li>
                        <li><a href="../estados/sinaloa/sinaloaindex.html">Sinaloa</a></li>
                        <li><a href="../estados/sonora/sonoraindex.html">Sonora</a></li>
                        <li><a href="../estados/tabasco/tabascoindex.html">Tabasco</a></li>
                        <li><a href="../estados/tamaulipas/tamaulipasindex.html">Tamaulipas</a></li>
                        <li><a href="../estados/tlaxcala/tlaxcalaindex.html">Tlaxcala</a></li>
                        <li><a href="../estados/veracruz/veracruzindex.html">Veracruz</a></li>
                        <li><a href="../estados/yucatan/yucatanindex.html">Yucatán</a></li>
                        <li><a href="../estados/zacatecas/zacatecasindex.html">Zacatecas</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </header>

        </header>

        <div class="logo-container">
            <img src="../imagenes/inm logo.png" alt="Logo INM">
        </div>

        <div class="header-container">
            <h1>GESTOR DE ARCHIVOS</h1>
        </div>

        <!-- Contenedor del visor PDF simplificado -->
        <div class="pdf-viewer-container">
            <div class="pdf-toolbar">
                <div id="pdf-title">Visualizador de PDF</div>
            </div>
            <iframe id="pdf-viewer"></iframe>
        </div>

        <!-- Panel de gestión de archivos -->
        <div class="gestion-archivos">
            <h2>Gestión de Archivos PDF</h2>
            
            <div class="fila-superior">
                <!-- Subir archivo -->
                <div class="upload-form">
                    <h3>Subir archivo</h3>
                    
                    <form id="uploadForm" enctype="multipart/form-data">
                        <input type="file" id="file" name="file" accept="application/pdf" required>
                        <select id="carpetaSelect">
                            <option value="aguascalientes">Aguascalientes</option>
                            <option value="baja-california">Baja California</option>
                            <option value="baja-california-sur">Baja California Sur</option>
                            <option value="campeche">Campeche</option>
                            <option value="chiapas">Chiapas</option>
                            <option value="chihuahua">Chihuahua</option>
                            <option value="ciudad-de-mexico">Ciudad de México</option>
                            <option value="coahuila">Coahuila</option>
                            <option value="colima">Colima</option>
                            <option value="durango">Durango</option>
                            <option value="estado-de-mexico">Estado de México</option>
                            <option value="guanajuato">Guanajuato</option>
                            <option value="guerrero">Guerrero</option>
                            <option value="hidalgo">Hidalgo</option>
                            <option value="jalisco">Jalisco</option>
                            <option value="michoacan">Michoacán</option>
                            <option value="morelos">Morelos</option>
                            <option value="nayarit">Nayarit</option>
                            <option value="nuevo-leon">Nuevo León</option>
                            <option value="oaxaca">Oaxaca</option>
                            <option value="puebla">Puebla</option>
                            <option value="queretaro">Querétaro</option>
                            <option value="quintana-roo">Quintana Roo</option>
                            <option value="san-luis-potosi">San Luis Potosí</option>
                            <option value="sinaloa">Sinaloa</option>
                            <option value="sonora">Sonora</option>
                            <option value="tabasco">Tabasco</option>
                            <option value="tamaulipas">Tamaulipas</option>
                            <option value="tlaxcala">Tlaxcala</option>
                            <option value="veracruz">Veracruz</option>
                            <option value="yucatan">Yucatán</option>
                            <option value="zacatecas">Zacatecas</option>
                        </select>
                        <label for="tipoSelect">Tipo de documento:</label>
                            <select id="tipoSelect">
                            <option value="">Todos</option>
                            <option value="ficha">Ficha Curricular</option>
                            <option value="organigrama">Organigrama</option>
                            <option value="plantilla">Plantilla de Personal</option>
                            <option value="vehiculos">Vehículos</option>
                            <option value="inmuebles">Inmuebles</option>
                            <option value="canina">Unidad Canina</option>
                            <option value="visita">Última Visita de Supervisión y Evaluación</option>
                            <option value="acuerdos">Acuerdos de Visita de Supervisión y Evaluación</option>
                        </select>

                        <button type="submit" id="uploadButton">Subir</button>
                        <p id="uploadStatus"></p>
                    </form>
                </div>

                <!-- Archivos disponibles -->
                <div class="file-list">
                    <h3>Archivos disponibles</h3>
                    <ul id="fileList"></ul>
                </div>
            </div>

            <!-- Eliminar archivo -->
            <div class="delete-file">
                <h3>Eliminar archivo</h3>
                <select id="fileSelect">
                    <option value="">Selecciona un archivo para eliminar</option>
                </select>
                <button id="deleteFileButton">Eliminar</button>
                <p id="deleteStatus"></p>
            </div>
        </div>

      <script>
    // Configuración global
    const BACKEND_URL = 'https://control-operativo-1.onrender.com/api';
    const API_KEY = 'Xhy2md57';
    let currentCarpeta = 'aguascalientes';
    let currentTipo = '';
    
    // Elementos del DOM
    let loadingElement, uploadForm, uploadButton, uploadStatus, pdfViewer, pdfTitle, 
        fileListContainer, fileSelect, deleteFileButton, deleteStatus, carpetaSelect, tipoSelect;

    // Mostrar/ocultar loading
    function showLoading(show) {
        if (loadingElement) {
            loadingElement.style.display = show ? 'flex' : 'none';
        }
    }

    // Mostrar mensaje de estado
    function showStatus(element, message, isError = false) {
        if (element) {
            element.textContent = message;
            element.className = isError ? 'error-message' : 'success-message';
            setTimeout(() => {
                element.textContent = '';
                element.className = '';
            }, 5000);
        }
    }

    // Función para mostrar PDF
    function mostrarPdf(url, filename = '') {
        if (!pdfViewer || !pdfTitle) return;
        
        if (!url) {
            pdfViewer.style.display = 'none';
            pdfTitle.textContent = 'Visualizador de PDF';
            return;
        }
        
        pdfViewer.style.display = 'block';
        pdfViewer.src = url;
        pdfTitle.textContent = filename || 'Documento PDF';
    }

    // Formatear tamaño de archivo
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // Formatear fecha
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('es-MX', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
    }

    // Cargar lista de archivos
    async function cargarListaArchivos() {
        showLoading(true);
        try {
            // Construir URL según si hay tipo seleccionado
            const url = currentTipo ? 
                `${BACKEND_URL}/archivos/${currentCarpeta}/${currentTipo}` :
                `${BACKEND_URL}/archivos/${currentCarpeta}`;
            
            const response = await fetch(url, {
                headers: { 'x-api-key': API_KEY }
            });
            
            if (!response.ok) throw new Error(`Error ${response.status}`);
            
            const { data } = await response.json();
            renderizarListaArchivos(data || []);
            
        } catch (error) {
            console.error('Error al cargar archivos:', error);
            if (uploadStatus) {
                showStatus(uploadStatus, 'Error al cargar archivos', true);
            }
        } finally {
            showLoading(false);
        }
    }

    // Renderizar lista de archivos
    function renderizarListaArchivos(files) {
        if (!fileListContainer || !fileSelect) return;
        
        fileListContainer.innerHTML = '';
        fileSelect.innerHTML = '<option value="">Selecciona un archivo para eliminar</option>';

        if (!files || files.length === 0) {
            fileListContainer.innerHTML = '<li>No hay archivos disponibles</li>';
            return;
        }

        files.sort((a, b) => new Date(b.uploaded_at) - new Date(a.uploaded_at));

        files.forEach(file => {
            const displayName = file.filename || file.public_id.split('/').pop() + '.pdf';
            
            // Item en la lista
            const li = document.createElement('li');
            li.innerHTML = `
                <div class="file-info">
                    <span class="filename">${displayName}</span>
                    <span class="file-meta">${formatFileSize(file.size)} • ${formatDate(file.uploaded_at)}</span>
                </div>
                <div class="file-actions">
                    <button class="btn-view" data-url="${file.url}">Ver</button>
                    <button class="btn-delete" data-id="${file.public_id}">Eliminar</button>
                </div>
            `;
            fileListContainer.appendChild(li);

            // Opción para eliminar
            const option = document.createElement('option');
            option.value = file.public_id;
            option.textContent = displayName;
            fileSelect.appendChild(option);
        });

        // Eventos para los botones
        document.querySelectorAll('.btn-view').forEach(btn => {
            btn.addEventListener('click', () => {
                const filenameElement = btn.closest('li')?.querySelector('.filename');
                mostrarPdf(btn.dataset.url, filenameElement?.textContent || '');
            });
        });

        document.querySelectorAll('.btn-delete').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                if (confirm('¿Eliminar este archivo?')) {
                    eliminarArchivo(btn.dataset.id);
                }
            });
        });
    }

    // Eliminar archivo
    async function eliminarArchivo(publicId) {
        showLoading(true);
        try {
            const response = await fetch(`${BACKEND_URL}/delete`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': API_KEY
                },
                body: JSON.stringify({
                    public_id: publicId
                })
            });

            const result = await response.json();
            if (response.ok) {
                showStatus(deleteStatus, result.message);
                cargarListaArchivos(); // recargar lista
            } else {
                showStatus(deleteStatus, result.error || 'Error al eliminar el archivo', true);
            }
        } catch (error) {
            console.error('Error al eliminar archivo:', error);
            showStatus(deleteStatus, 'Error de conexión al eliminar archivo', true);
        } finally {
            showLoading(false);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        // Inicialización de variables de elementos del DOM
        loadingElement = document.getElementById('loading');
        uploadForm = document.getElementById('uploadForm');
        uploadButton = document.getElementById('uploadButton');
        uploadStatus = document.getElementById('uploadStatus');
        pdfViewer = document.getElementById('pdf-viewer');
        pdfTitle = document.getElementById('pdf-title');
        fileListContainer = document.getElementById('fileList');
        fileSelect = document.getElementById('fileSelect');
        deleteFileButton = document.getElementById('deleteFileButton');
        deleteStatus = document.getElementById('deleteStatus');
        carpetaSelect = document.getElementById('carpetaSelect');
        tipoSelect = document.getElementById('tipoSelect');

        // Manejo del formulario de carga
        uploadForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            showLoading(true);
            const formData = new FormData();
            formData.append('file', uploadForm.file.files[0]);
            formData.append('carpeta', carpetaSelect.value);
            formData.append('tipo', tipoSelect.value);

            try {
                const response = await fetch(`${BACKEND_URL}/upload`, {
                    method: 'POST',
                    headers: { 'x-api-key': API_KEY },
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showStatus(uploadStatus, result.message);
                    uploadForm.reset();
                    cargarListaArchivos(); // recargar lista
                } else {
                    showStatus(uploadStatus, result.error || 'Error al subir el archivo.', true);
                }
            } catch (error) {
                showStatus(uploadStatus, 'Error de red al subir el archivo.', true);
            } finally {
                showLoading(false);
            }
        });

        // Manejo de la eliminación de archivo
        deleteFileButton.addEventListener('click', async () => {
            const publicId = fileSelect.value;
            if (!publicId) return;

            if (confirm('¿Estás seguro de eliminar este archivo?')) {
                await eliminarArchivo(publicId);
            }
        });

        // Manejar cambios en los selects
        carpetaSelect.addEventListener('change', () => {
            currentCarpeta = carpetaSelect.value;
            cargarListaArchivos();
        });

        tipoSelect.addEventListener('change', () => {
            currentTipo = tipoSelect.value;
            cargarListaArchivos();
        });

        // Cargar archivos al iniciar
        cargarListaArchivos();
    });

    // Menú hamburguesa
    function toggleMenu() {
        const menu = document.querySelector('.menu');
        const overlay = document.querySelector('.menu-overlay');
        if (menu && overlay) {
            menu.classList.toggle('active');
            overlay.classList.toggle('active');
        }
    }

    // Función para cerrar todos los submenús
    function closeAllSubmenus() {
        const submenus = document.querySelectorAll('.submenu.active');
        submenus.forEach(submenu => {
            submenu.classList.remove('active');
        });
    }

    // Función para mostrar/ocultar el submenú
    function toggleSubmenu(event) {
        event.preventDefault();
        const submenu = event.target.closest('.submenu');
        if (submenu.classList.contains('active')) {
            submenu.classList.remove('active');
        } else {
            closeAllSubmenus();
            submenu.classList.add('active');
        }
    }

    // Cerrar menús al hacer clic fuera
    const menuOverlay = document.querySelector('.menu-overlay');
    menuOverlay.addEventListener('click', () => {
        const menu = document.querySelector('.menu');
        menu.classList.remove('active');
        menuOverlay.classList.remove('active');
    });

    document.addEventListener('click', (e) => {
        if (!e.target.closest('.submenu')) {
            closeAllSubmenus();
        }
    });

    const submenuLinks = document.querySelectorAll('.submenu-list a');
    submenuLinks.forEach(link => {
        link.addEventListener('click', () => {
            closeAllSubmenus();
        });
    });
</script>
    </body>
    </html>
