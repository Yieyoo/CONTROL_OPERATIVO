<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PLANTILLA DE PERSONAL</title>
    <link rel="icon" type="image/png" href="../../../imagenes/pasaporte.png">
    <link rel="stylesheet" href="../../diseños/diseñounafoto.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div class="menu-overlay"></div>

    <header>
        <button class="menu-toggle" onclick="toggleMenu()">☰</button>
        <nav class="menu">
            <img src="../../../imagenes/gobernacion.jpg" class="logo-arriba-img" alt="Logo">
            <ul>
                <li><a href="../../../index.html">Inicio</a></li>
                <li class="submenu">
                    <a href="javascript:void(0);" onclick="toggleSubmenu(event)">Datos Nacionales</a>
                    <ul class="submenu-list">
                        <li><a href="../../../datos_nacionales/datosindex.html">Datos Nacionales</a></li>
                        <li><a href="../../../datos_nacionales/opcionesdatos/plantillad.html">Plantilla de Personal</a></li>
                        <li><a href="../../../datos_nacionales/opcionesdatos/tabulador.html">Tabulador</a></li>
                        <li><a href="../../../datos_nacionales/opcionesdatos/rubro.html">Gastos de Operación</a></li>
                        <li><a href="../../../datos_nacionales/opcionesdatos/estadofuerza.html">Analitico Estado Fuerza</a></li>
                        <li><a href="../../../datos_nacionales/opcionesdatos/unidadcd.html">Unidades Caninas</a></li>
                        <li><a href="../../../construccion.html">Inmuebles</a></li>
                        <li><a href="../../../construccion.html">Padron Vehicular</a></li>
                        <li><a href="../../../gestion/archivos.html">Gestion de Archvios</a></li>
                    </ul>
                </li>
                <li class="submenu">
                    <a href="javascript:void(0);" onclick="toggleSubmenu(event)">Información de ORs</a>
                    <ul class="submenu-list">
                        <li><a href="../aguascalientesindex.html">Aguascalientes</a></li>
                        <li><a href="../../baja_california/baja_californiaindex.html">Baja California</a></li>
                        <li><a href="../../baja_california_s/baja_california_surindex.html">Baja California Sur</a></li>
                        <li><a href="../../campeche/campecheindex.html">Campeche</a></li>
                        <li><a href="../../chiapas/chiapasindex.html">Chiapas</a></li>
                        <li><a href="../../chihuahua/chihuahuaindex.html">Chihuahua</a></li>
                        <li><a href="../../coahuila/coahuilaindex.html">Coahuila</a></li>
                        <li><a href="../../colima/colimaindex.html">Colima</a></li>
                        <li><a href="../../cdmx/cdmxindex.html">Ciudad de México</a></li>
                        <li><a href="../../durango/durangoindex.html">Durango</a></li>
                        <li><a href="../../guanajuato/guanajuatoindex.html">Guanajuato</a></li>
                        <li><a href="../../guerrero/guerreroindex.html">Guerrero</a></li>
                        <li><a href="../../hidalgo/hidalgoindex.html">Hidalgo</a></li>
                        <li><a href="../../jalisco/jaliscoindex.html">Jalisco</a></li>
                        <li><a href="../../edomex/edomexindex.html">Estado de México</a></li>
                        <li><a href="../../michoacan/michoacanindex.html">Michoacán</a></li>
                        <li><a href="../../morelos/morelosindex.html">Morelos</a></li>
                        <li><a href="../../nayarit/nayaritindex.html">Nayarit</a></li>
                        <li><a href="../../nuevo_leon/nuevo_leonindex.html">Nuevo León</a></li>
                        <li><a href="../../oaxaca/oaxacaindex.html">Oaxaca</a></li>
                        <li><a href="../../puebla/pueblaindex.html">Puebla</a></li>
                        <li><a href="../../quererato/queretaroindex.html">Querétaro</a></li>
                        <li><a href="../../quintanaroo/quintanarooindex.html">Quintana Roo</a></li>
                        <li><a href="../../san_luis/san_luisindex.html">San Luis Potosí</a></li>
                        <li><a href="../../sinaloa/sinaloaindex.html">Sinaloa</a></li>
                        <li><a href="../../sonora/sonoraindex.html">Sonora</a></li>
                        <li><a href="../../tabasco/tabascoindex.html">Tabasco</a></li>
                        <li><a href="../../tamaulipas/tamaulipasindex.html">Tamaulipas</a></li>
                        <li><a href="../../tlaxcala/tlaxcalaindex.html">Tlaxcala</a></li>
                        <li><a href="../../veracruz/veracruzindex.html">Veracruz</a></li>
                        <li><a href="../../yucatan/yucatanindex.html">Yucatán</a></li>
                        <li><a href="../../zacatecas/zacatecasindex.html">Zacatecas</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </header>

    <div class="logo-container">
        <img src="../../../imagenes/inm logo.png" alt="Logo 1">
    </div>
    
    <div class="header-container qna">
        <h1 id="document-title">Cargando documento...</h1>
    </div>
    
    <div class="pdf-container">
        <iframe id="pdf-viewer" class="pdf-embed" frameborder="0"></iframe>
    </div>

    <div id="pdf-status-message" class="status-message"></div>

    <button class="regresar-btn">Regresar</button>

    <script>
        // Configuración dinámica basada en parámetros URL
        const API_BASE_URL = 'https://control-operativo-1.onrender.com/api';
        const LOCAL_BASE_PATH = '../../../documentacion/plantillas_personal';
        
        // Obtener parámetros de la URL
        const urlParams = new URLSearchParams(window.location.search);
        const estado = urlParams.get('estado') || 'aguascalientes';
        const tipoDocumento = urlParams.get('tipo') || 'plantilla_personal';
        
        // Mapeo de nombres legibles
        const NOMBRES_ESTADOS = {
            aguascalientes: 'Aguascalientes',
            baja_california: 'Baja California',
            baja_california_sur: 'Baja California Sur',
            campeche: 'Campeche',
            chiapas: 'Chiapas',
            chihuahua: 'Chihuahua',
            cdmx: 'Ciudad de México',
            coahuila: 'Coahuila',
            colima: 'Colima',
            durango: 'Durango',
            guanajuato: 'Guanajuato',
            guerrero: 'Guerrero',
            hidalgo: 'Hidalgo',
            jalisco: 'Jalisco',
            edomex: 'Estado de México',
            michoacan: 'Michoacán',
            morelos: 'Morelos',
            nayarit: 'Nayarit',
            nuevo_leon: 'Nuevo León',
            oaxaca: 'Oaxaca',
            puebla: 'Puebla',
            quererato: 'Querétaro',
            quintanaroo: 'Quintana Roo',
            san_luis: 'San Luis Potosí',
            sinaloa: 'Sinaloa',
            sonora: 'Sonora',
            tabasco: 'Tabasco',
            tamaulipas: 'Tamaulipas',
            tlaxcala: 'Tlaxcala',
            veracruz: 'Veracruz',
            yucatan: 'Yucatán',
            zacatecas: 'Zacatecas'
        };
        
        const NOMBRES_DOCUMENTOS = {
            plantilla_personal: 'Plantilla de Personal',
            ficha_curricular: 'Ficha Curricular',
            organigrama: 'Organigrama',
            visita_supervision: 'Visita de Supervisión',
            acuerdos_visita: 'Acuerdos de Visita',
            vehiculos: 'Vehículos',
            inmuebles: 'Inmuebles',
            unidad_canina: 'Unidad Canina'
        };

        async function loadPDF() {
            const statusElement = document.getElementById('pdf-status-message');
            const pdfViewer = document.getElementById('pdf-viewer');
            const titleElement = document.getElementById('document-title');
            
            // Actualizar título del documento
            const estadoNombre = NOMBRES_ESTADOS[estado] || estado;
            const docNombre = NOMBRES_DOCUMENTOS[tipoDocumento] || tipoDocumento;
            titleElement.textContent = `${docNombre} - ${estadoNombre}`;
            document.title = `${docNombre} - ${estadoNombre}`;
            
            try {
                statusElement.textContent = 'Cargando documento...';
                statusElement.style.color = '#333';
                
                // 1. Intento desde API
                const apiUrl = `${API_BASE_URL}/archivos/${estado}/${tipoDocumento}?v=${Date.now()}`;
                const response = await axios.get(apiUrl, {
                    timeout: 8000,
                    headers: { 
                        'Cache-Control': 'no-cache',
                        'x-api-key': 'Xhy2md57' // Asegúrate de usar tu API key real
                    }
                });

                if (response.data?.url) {
                    pdfViewer.src = response.data.url;
                    statusElement.textContent = '';
                } else {
                    throw new Error('Formato de respuesta inválido');
                }
                
            } catch (error) {
                console.error('Error API:', error);
                
                // 2. Intento desde archivo local
                const localPath = `${LOCAL_BASE_PATH}/${estado}/${tipoDocumento}.pdf`;
                pdfViewer.src = localPath;
                
                // Manejo de errores para el PDF local
                pdfViewer.onerror = () => {
                    statusElement.textContent = 'Documento no disponible en el servidor ni localmente';
                    statusElement.style.color = '#dc3545';
                    pdfViewer.src = '';
                };
                
                pdfViewer.onload = () => {
                    statusElement.textContent = 'Documento local cargado correctamente';
                    statusElement.style.color = '#28a745';
                    setTimeout(() => statusElement.textContent = '', 3000);
                };
            }
        }

        // Funciones del menú (se mantienen igual)
        function toggleMenu() {
            const menu = document.querySelector('.menu');
            const menuOverlay = document.querySelector('.menu-overlay');
            menu.classList.toggle('active');
            menuOverlay.classList.toggle('active');
        }

        function closeAllSubmenus() {
            const submenus = document.querySelectorAll('.submenu.active');
            submenus.forEach(submenu => {
                submenu.classList.remove('active');
            });
        }

        function toggleSubmenu(event) {
            event.preventDefault();
            closeAllSubmenus();
            const submenu = event.target.closest('.submenu');
            submenu.classList.toggle('active');
        }

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.submenu')) {
                closeAllSubmenus();
            }
        });

        const submenuLinks = document.querySelectorAll('.submenu-list a');
        submenuLinks.forEach(link => {
            link.addEventListener('click', () => {
                closeAllSubmenus();
            });
        });

        document.querySelector('.regresar-btn').addEventListener('click', function() {
            window.history.back();
        });

        // Cargar el PDF cuando la página esté lista
        document.addEventListener('DOMContentLoaded', loadPDF);

        // Recargar cada 5 minutos para mantener actualizado
        setInterval(loadPDF, 300000);
    </script>
</body>
</html>