<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PLANTILLA DE PERSONAL - AGUASCALIENTES</title>
    <link rel="icon" type="image/png" href="../../../imagenes/pasaporte.png">
    <link rel="stylesheet" href="../../diseños/diseñounafoto.css">
    <style>
        .error-message {
            color: red;
            padding: 10px;
            background-color: #ffeeee;
            border: 1px solid #ffcccc;
            margin: 10px 0;
            text-align: center;
        }
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .pdf-container {
            width: 100%;
            height: 80vh;
            margin: 20px 0;
        }
        .pdf-embed {
            width: 100%;
            height: 100%;
            border: none;
        }
        .mobile-images {
            display: none;
        }
        @media (max-width: 768px) {
            .pdf-container {
                display: none;
            }
            .mobile-images {
                display: block;
                text-align: center;
            }
            .mobile-images img {
                max-width: 100%;
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <div class="header-container qna">
        <h1></h1>
    </div>
    <!-- Fondo oscuro para el menú -->
    <div class="menu-overlay"></div>
    
    <!-- Loading spinner -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <header>
        <!-- Botón para abrir el menú en móviles -->
        <button class="menu-toggle" onclick="toggleMenu()">☰</button>

        <!-- Menú principal -->
        <nav class="menu">
            <img src="../../../imagenes/gobernacion.jpg" class="logo-arriba-img" alt="Logo">
            <ul>
                <li><a href="../../../index.html">Inicio</a></li>
                <li class="submenu">
                    <a href="javascript:void(0);" onclick="toggleSubmenu(event)">Datos Nacionales</a>
                    <ul class="submenu-list">
                        <li><a href="../../../ddatos_nacionales/datosindex.html">Datos Nacionales</a></li>
                    <li><a href="../../../datos_nacionales/opcionesdatos/plantillad.html">Plantilla de Personal</a></li>
                    <li><a href="../../../datos_nacionales/opcionesdatos/tabulador.html">Tabulador</a></li>
                    <li><a href="../../../datos_nacionales/opcionesdatos/rubro.html">Gastos de Operación</a></li>
                    <li><a href="../../../datos_nacionales/opcionesdatos/estadofuerza.html">Analitico Estado Fuerza</a></li>
                    <li><a href="../../../datos_nacionales/opcionesdatos/unidadcd.html">Unidades Caninas</a></li>
                    <li><a href="../../../construccion.html">Inmuebles</a></li>
                    <li><a href="../../../construccion.html">Padron Vehicular</a></li>
                    <li><a href="../../../gestion/archivos.html">Gestion de Archvios</a></li>
                    </ul>
                </li>
                <li class="submenu">
                    <a href="javascript:void(0);" onclick="toggleSubmenu(event)">Información de ORs</a>
                    <ul class="submenu-list">
                        <li><a href="../aguascalientesindex.html">Aguascalientes</a></li>
                        <!-- Otros estados... -->
                    </ul>
                </li>
            </ul>
        </nav>
    </header>

    <!-- Contenedor de logos -->
    <div class="logo-container">
        <img src="../../../imagenes/inm logo.png" alt="Logo INM">
    </div>
    
    <div class="header-container qna">
       
    </div>
    
    <!-- Contenedor del PDF -->
    <div class="pdf-container">
        <iframe 
            id="pdf-viewer" 
            class="pdf-embed"
            frameborder="0"
            title="Visualizador de PDF"
        ></iframe>
        <div id="pdf-error" class="error-message" style="display: none;"></div>
    </div>

    <!-- Contenedor de imágenes para móviles -->
    <div class="mobile-images">
        <div id="mobile-error" class="error-message" style="display: none;"></div>
    </div>

    <button class="regresar-btn" onclick="window.history.back()">Regresar</button>

    <!-- Scripts -->
    <script>
        // Configuración
        const BACKEND_URL = 'https://control-operativo-1.onrender.com/api';
        const API_KEY = 'Xhy2md57';
        const ESTADO_FIJO = 'aguascalientes';
        
        // Mostrar/ocultar loading
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'flex' : 'none';
        }

        // Mostrar mensaje de error
        function showError(message, target = 'both') {
            if (target === 'both' || target === 'pdf') {
                const pdfError = document.getElementById('pdf-error');
                pdfError.textContent = message;
                pdfError.style.display = 'block';
            }
            if (target === 'both' || target === 'mobile') {
                const mobileError = document.getElementById('mobile-error');
                mobileError.textContent = message;
                mobileError.style.display = 'block';
            }
        }

        // Ocultar errores
        function hideErrors() {
            document.getElementById('pdf-error').style.display = 'none';
            document.getElementById('mobile-error').style.display = 'none';
        }

        // Función para abrir/cerrar el menú
        function toggleMenu() {
            const menu = document.querySelector('.menu');
            const overlay = document.querySelector('.menu-overlay');
            menu.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        // Cerrar menú al hacer clic fuera
        document.querySelector('.menu-overlay').addEventListener('click', toggleMenu);

        // Función para submenús
        function toggleSubmenu(event) {
            event.preventDefault();
            document.querySelectorAll('.submenu.active').forEach(sub => {
                if (sub !== event.target.closest('.submenu')) {
                    sub.classList.remove('active');
                }
            });
            event.target.closest('.submenu').classList.toggle('active');
        }

        // Cargar PDF de Aguascalientes
        async function loadStatePDF() {
            showLoading(true);
            hideErrors();

            try {
                console.log(`Consultando API para: ${ESTADO_FIJO}`);
                const response = await fetch(`${BACKEND_URL}/archivos/${ESTADO_FIJO}`, {
                    headers: { 'x-api-key': API_KEY }
                });
                
                if (!response.ok) throw new Error(`Error ${response.status}: ${response.statusText}`);
                
                const result = await response.json();
                console.log('Respuesta API:', result);
                
                if (!result?.data) throw new Error('Formato de respuesta inválido');

                const pdfViewer = document.getElementById('pdf-viewer');
                const mobileContainer = document.querySelector('.mobile-images');
                
                if (result.data.length > 0) {
                    const latestPDF = result.data.sort((a, b) => 
                        new Date(b.uploaded_at) - new Date(a.uploaded_at)
                    )[0];
                    
                    pdfViewer.src = latestPDF.url;
                    mobileContainer.innerHTML = `
                        <img src="${latestPDF.url.replace('.pdf', '_page-0001.jpg')}" alt="Página 1">
                        <img src="${latestPDF.url.replace('.pdf', '_page-0002.jpg')}" alt="Página 2">
                    `;
                } else {
                    showError('No se encontraron documentos para Aguascalientes', 'both');
                }
            } catch (error) {
                console.error('Error:', error);
                showError(`Error al cargar: ${error.message}`, 'both');
            } finally {
                showLoading(false);
            }
        }

        // Inicialización
        document.addEventListener('DOMContentLoaded', () => {
            // Cargar PDF al iniciar
            if (document.getElementById('pdf-viewer')) {
                loadStatePDF();
            }
            
            // Cerrar menús al hacer clic en opción
            document.querySelectorAll('.submenu-list a').forEach(link => {
                link.addEventListener('click', () => {
                    document.querySelectorAll('.submenu').forEach(sub => {
                        sub.classList.remove('active');
                    });
                });
            });
        });
    </script>
</body>
</html>