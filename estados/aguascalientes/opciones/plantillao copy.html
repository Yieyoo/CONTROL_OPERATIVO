<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PLANTILLA DE PERSONAL</title>
    <link rel="icon" type="image/png" href="../../../imagenes/pasaporte.png">
    <link rel="stylesheet" href="../../diseños/diseñounafoto.css">
    <!-- Agregamos axios para las peticiones HTTP -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <!-- Fondo oscuro para el menú -->
    <div class="menu-overlay"></div>

    <header>
        <!-- Botón para abrir el menú en móviles -->
        <button class="menu-toggle" onclick="toggleMenu()">☰</button>

        <!-- Menú principal -->
        <nav class="menu">
            <img src="../../../imagenes/gobernacion.jpg" class="logo-arriba-img" alt="Logo">
            <ul>
                <li><a href="../../../index.html">Inicio</a></li>
                <!-- Submenú Datos Nacionales -->
                <li class="submenu">
                    <a href="javascript:void(0);" onclick="toggleSubmenu(event)">Datos Nacionales</a>
                    <ul class="submenu-list">
                       <li><a href="../../../datos_nacionales/datosindex.html">Datos Nacionales</a></li>
                    <li><a href="../../../datos_nacionales/opcionesdatos/plantillad.html">Plantilla de Personal</a></li>
                    <li><a href="../../../datos_nacionales/opcionesdatos/tabulador.html">Tabulador</a></li>
                    <li><a href="../../../datos_nacionales/opcionesdatos/rubro.html">Gastos de Operación</a></li>
                    <li><a href="../../../datos_nacionales/opcionesdatos/estadofuerza.html">Analitico Estado Fuerza</a></li>
                    <li><a href="../../../datos_nacionales/opcionesdatos/unidadcd.html">Unidades Caninas</a></li>
                    <li><a href="../../../construccion.html">Inmuebles</a></li>
                    <li><a href="../../../construccion.html">Padron Vehicular</a></li>
                    <li><a href="../../../gestion/archivos.html">Gestion de Archvios</a></li>
                    </ul>
                </li>

                <!-- Submenú Información de ORs -->
                <li class="submenu">
                    <a href="javascript:void(0);" onclick="toggleSubmenu(event)">Información de ORs</a>
                    <ul class="submenu-list">
                        <li><a href="../aguascalientesindex.html">Aguascalientes</a></li>
                        <li><a href="../../baja_california/baja_californiaindex.html">Baja California</a></li>
                        <li><a href="../../baja_california_s/baja_california_surindex.html">Baja California Sur</a></li>
                        <li><a href="../../campeche/campecheindex.html">Campeche</a></li>
                        <li><a href="../../chiapas/chiapasindex.html">Chiapas</a></li>
                        <li><a href="../../chihuahua/chihuahuaindex.html">Chihuahua</a></li>
                        <li><a href="../../coahuila/coahuilaindex.html">Coahuila</a></li>
                        <li><a href="../../colima/colimaindex.html">Colima</a></li>
                        <li><a href="../../cdmx/cdmxindex.html">Ciudad de México</a></li>
                        <li><a href="../../durango/durangoindex.html">Durango</a></li>
                        <li><a href="../../guanajuato/guanajuatoindex.html">Guanajuato</a></li>
                        <li><a href="../../guerrero/guerreroindex.html">Guerrero</a></li>
                        <li><a href="../../hidalgo/hidalgoindex.html">Hidalgo</a></li>
                        <li><a href="../../jalisco/jaliscoindex.html">Jalisco</a></li>
                        <li><a href="../../edomex/edomexindex.html">Estado de México</a></li>
                        <li><a href="../../michoacan/michoacanindex.html">Michoacán</a></li>
                        <li><a href="../../morelos/morelosindex.html">Morelos</a></li>
                        <li><a href="../../nayarit/nayaritindex.html">Nayarit</a></li>
                        <li><a href="../../nuevo_leon/nuevo_leonindex.html">Nuevo León</a></li>
                        <li><a href="../../oaxaca/oaxacaindex.html">Oaxaca</a></li>
                        <li><a href="../../puebla/pueblaindex.html">Puebla</a></li>
                        <li><a href="../../quererato/queretaroindex.html">Querétaro</a></li>
                        <li><a href="../../quintanaroo/quintanarooindex.html">Quintana Roo</a></li>
                        <li><a href="../../san_luis/san_luisindex.html">San Luis Potosí</a></li>
                        <li><a href="../../sinaloa/sinaloaindex.html">Sinaloa</a></li>
                        <li><a href="../../sonora/sonoraindex.html">Sonora</a></li>
                        <li><a href="../../tabasco/tabascoindex.html">Tabasco</a></li>
                        <li><a href="../../tamaulipas/tamaulipasindex.html">Tamaulipas</a></li>
                        <li><a href="../../tlaxcala/tlaxcalaindex.html">Tlaxcala</a></li>
                        <li><a href="../../veracruz/veracruzindex.html">Veracruz</a></li>
                        <li><a href="../../yucatan/yucatanindex.html">Yucatán</a></li>
                        <li><a href="../../zacatecas/zacatecasindex.html">Zacatecas</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </header>

    <!-- Contenedor de logos -->
    <div class="logo-container">
        <img src="../../../imagenes/inm logo.png" alt="Logo 1">
    </div>
    
    <div class="header-container qna">
        <h1>Plantilla de Personal - Aguascalientes</h1>
    </div>
    
    <!-- Contenedor del PDF desde Cloudinary -->
    <div class="pdf-container">
        <iframe id="cloudinary-pdf-viewer" class="pdf-embed" frameborder="0"></iframe>
    </div>

    <!-- Mensaje de estado -->
    <div id="pdf-status-message" class="status-message"></div>

    <!-- Contenedor de imágenes solo visible en dispositivos móviles (opcional) -->
    <div class="mobile-images" id="mobile-images-container">
        <!-- Las imágenes se cargarán dinámicamente -->
    </div>

    <button class="regresar-btn">Regresar</button>

    <!-- Scripts -->
    <script>
        // Configuración de Cloudinary
        const CLOUDINARY_BASE_URL = 'https://res.cloudinary.com';
        const CLOUD_NAME = 'tu_cloud_name'; // Reemplaza con tu cloud name de Cloudinary
        const API_KEY = 'tu_api_key'; // Reemplaza con tu API key
        const FOLDER_PATH = 'aguascalientes/plantilla_personal';

       async function loadPdfFromCloudinary() {
    const statusElement = document.getElementById('pdf-status-message');
    const pdfViewer = document.getElementById('cloudinary-pdf-viewer');
    
    try {
        statusElement.textContent = 'Cargando documento...';
        statusElement.style.color = '#333';
        
        // 1. Verificar si la API está disponible
        const apiCheck = await axios.get('/api/health');
        if (apiCheck.data.status !== 'healthy') {
            throw new Error('API no disponible');
        }

        // 2. Obtener lista de archivos
        const response = await axios.get(`/api/archivos/aguascalientes/plantilla_personal`, {
            headers: {
                'x-api-key': API_KEY,
                'Content-Type': 'application/json'
            }
        });

        if (!response.data.data || response.data.data.length === 0) {
            throw new Error('No se encontraron archivos en Cloudinary');
        }

        // 3. Tomar el primer PDF encontrado
        const pdfFile = response.data.data[0];
        const pdfUrl = pdfFile.url;
        
        // 4. Cargar el PDF en el visor
        pdfViewer.src = `https://docs.google.com/viewer?url=${encodeURIComponent(pdfUrl)}&embedded=true`;
        statusElement.textContent = '';

    } catch (error) {
        console.error('Error al cargar el PDF:', error);
        
        // Mostrar mensaje de error detallado
        let errorMessage = 'Error al cargar el documento';
        
        if (error.response) {
            // Error de la API
            if (error.response.status === 404) {
                errorMessage = 'La ruta del API no fue encontrada (404)';
            } else if (error.response.status === 401) {
                errorMessage = 'No autorizado - verifica tu API key';
            }
        } else if (error.message.includes('No se encontraron archivos')) {
            errorMessage = 'No hay documentos en la carpeta de Aguascalientes';
        }
        
        statusElement.textContent = `${errorMessage}. Cargando versión local...`;
        statusElement.style.color = '#d9534f';
        
        // Cargar PDF local como respaldo
        pdfViewer.src = "../../../documentacion/plantillas_personal/aguascp/AC1.pdf";
    }
}

        // Función para abrir y cerrar el menú lateral
        function toggleMenu() {
            const menu = document.querySelector('.menu');
            const menuOverlay = document.querySelector('.menu-overlay');
            menu.classList.toggle('active');
            menuOverlay.classList.toggle('active');
        }

        // Cerrar el menú al hacer clic fuera de él
        const menuOverlay = document.querySelector('.menu-overlay');
        menuOverlay.addEventListener('click', () => {
            const menu = document.querySelector('.menu');
            menu.classList.remove('active');
            menuOverlay.classList.remove('active');
        });

        // Función para cerrar todos los submenús
        function closeAllSubmenus() {
            const submenus = document.querySelectorAll('.submenu.active');
            submenus.forEach(submenu => {
                submenu.classList.remove('active');
            });
        }

        // Función para mostrar/ocultar el submenú
        function toggleSubmenu(event) {
            event.preventDefault();
            closeAllSubmenus();
            const submenu = event.target.closest('.submenu');
            submenu.classList.toggle('active');
        }

        // Cerrar el submenú al hacer clic fuera de él
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.submenu')) {
                closeAllSubmenus();
            }
        });

        // Cerrar el submenú al hacer clic en una opción
        const submenuLinks = document.querySelectorAll('.submenu-list a');
        submenuLinks.forEach(link => {
            link.addEventListener('click', () => {
                closeAllSubmenus();
            });
        });

        // Regresar al historial
        document.querySelector('.regresar-btn').addEventListener('click', function() {
            window.history.back();
        });

        // Cargar el PDF cuando la página esté lista
        document.addEventListener('DOMContentLoaded', loadPdfFromCloudinary);
    </script>
</body>
</html>